{% if _yn_tracking_tool %}
	{% isCookieActiveSeo findCookie(_yn_tracking_tool.consent.alias) %}
		<!-- Matomo -->
		<script>
			let _yn_url = '{{_yn_tracking_tool.url}}'
			if(_yn_url.slice(-1) !== '/'){
				_yn_url += '/'
			}
			var _paq = window._paq = window._paq || [];
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['enableLinkTracking']);
			(function() {
				var u=`//${_yn_url}`;
				_paq.push(['setTrackerUrl', u+'matomo.php']);
				_paq.push(['setSiteId', '{{ _yn_tracking_tool.siteId|default(1) }}']);
				_paq.push(['setDomains', ["*.{{ _yn_tracking_tool.domain|default(_ynfinite.domain.hostname) }}"]]);
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
			})();
		</script>
		<!-- End Matomo Code -->

		<script>
			if(!window.addedScripts.includes('matomo-{{_yn_tracking_tool.url}}')){
				// ==================================================
				// Start Tracking
				// ==================================================

				if(_yn_debug){
					console.log('%c-> Matomo added <-', 'color: #e91f63')
				}	
				
				// ==================================================
				// Page View Tracking
				// ==================================================

				{% if _yn_tracking_pageViews %}
					const _yn_trackPageView = () => {
						if(!window._yn_skipMatomoPageView){
							const params = window._yn_matomoParams || {};
							if(params.title){
								_paq.push(['trackPageView', params.title]);
							} else {
								_paq.push(['trackPageView']);
							}
						}
					}
					window._yn_pageViewEvents.push(_yn_trackPageView);
				{% endif %}

				// ==================================================
				// Form Tracking
				// ==================================================

				{% if _yn_tracking_submit_form %}
					function _yn_formTracking(_yn_name, _yn_id, _yn_eventName, _yn_formData) {
						if(!window._yn_skipMatomoForm){
							let params = window._yn_matomoParams || {};
							
							if(_yn_formData){
								params = { ...params, ..._yn_formData }
							}

							_paq.push(['trackEvent', params.category || 'Form Submit', params.action || _yn_name, params.name, params.value]);
						}
					}
					window._yn_formEvents.push(_yn_formTracking);
				{% endif %}

				// ==================================================
				// Video Tracking
				// ==================================================

				{% if _yn_tracking_video %}
					const _yn_videoTracking = (_yn_video) => {
						if(!window._yn_skipMatomoVideo){
							const _yn_videoState = _yn_video.state;
							const _yn_videoUrl = _yn_video.url;
							const _yn_videoPercent = Math.round(_yn_video.percent * 100) + '%';

							let category, action, name, value;

							switch (_yn_videoState) {
								case 0: 
									category = 'Video complete';
									action = _yn_videoUrl;
									break;
								case 1: 
									category = 'Video start';
									action = _yn_videoUrl;
									break;
								case 2: 
									category = 'Video pause';
									action = _yn_videoUrl;
									name = _yn_videoPercent;
									break;
								default:
							}

							if(window._yn_matomoParams){
								const params = window._yn_matomoParams;
								category = params.category || category;
								action = params.action || action;
								name = params.name || name;
								value = params.value || value;
							}

							if(category){
								_paq.push(['trackEvent', category, action, name, value]);
							}
						}
					}
				
					window._yn_videoEvents.push(_yn_videoTracking);
				{% endif %}

				// ==================================================
				// Add Link Tracking
				{% if _yn_tracking_external or _yn_tracking_downloads or _yn_tracking_email or _yn_tracking_tel %}
					const _yn_linkTracking = (_yn_eventName = 'click', _yn_url) => {
						if(!window._yn_skipMatomoLink){
							if(_yn_eventName === 'click') _yn_eventName = 'External Link Click'
							if(_yn_eventName === 'click_mail') _yn_eventName = 'Mail Link Click'
							if(_yn_eventName === 'click_phone') _yn_eventName = 'Phone Link Click'
							if(_yn_eventName === 'click_download') _yn_eventName = 'Download Link Click'
							
							const params = window._yn_matomoParams || {};
							_paq.push(['trackEvent', params.category || 'Link Click', params.action || _yn_eventName, params.name || _yn_url]);
						}
					}
					window._yn_linkEvents.push(_yn_linkTracking)
				{% endif %}
					window._yn_linkEvents.push(_yn_linkTracking)
				{% endif %}

				// ==================================================
				// Scroll Tracking
				{% if _yn_tracking_pageScroll %}
					const _yn_scrollTracking = (_yn_name, _yn_depth) => {
						if(!window._yn_skipMatomoScroll){
							const params = window._yn_matomoParams || {};
							_paq.push(['trackEvent', params.category || 'Scroll', params.action || 'Section', params.name || _yn_name]);
							_paq.push(['trackEvent', 'Scroll depth', _yn_depth + '%']);
						}
					}
					window._yn_scrollEvents.push(_yn_scrollTracking)
				{% endif %}
					window._yn_scrollEvents.push(_yn_scrollTracking)
				{% endif %}

				// ==================================================
				// End Tracking
				// ==================================================

				window.addedScripts.push('matomo-{{_yn_tracking_tool.url}}')
			}
		</script>
	{% endIsCookieActiveSeo %}
{% endif %}