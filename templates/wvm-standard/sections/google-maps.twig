{% set data = section.data %}

<section class="section wow fadeInUp">
	{% getCookieConsent "google_maps" %}
		<div id="google-map" class="iframe iframe--maps"></div>
		<script>
			function initMap() {
				var markers = [];
				var bounds = new google.maps.LatLngBounds();
				var markerData = [
					{% for item in data.general_projekte %}
						{% if item.data.panel_google_maps_coords.lat and item.data.panel_google_maps_coords.lng %}
							{
								position: {
									lat: {{ item.data.panel_google_maps_coords.lat }},
									lng: {{ item.data.panel_google_maps_coords.lng }}
								},
								title: "{{ item.data.panel_intro_projektname }}",
								type: "{{ item.raw.general_projektart }}",
								link: "{{ _yfunc.linkPage('projekt', item.settings.seo.alias) }}",
								{% if item.raw.general_projektart == "preview" %}
									icon : "{{ template.data.general_map_icons[0].path }}",
								{% else %}
									icon : "{{ template.data.general_map_icons[1].path }}",
								{% endif %}
							},
						{% endif %}
					{% endfor %}]

				var mapCenter = {
					lat: 0,
					lng: 0
				};

				var map = new google.maps.Map(document.getElementById('google-map'), {
					zoom: 4,
					center: mapCenter,
					styles: mapStyles
				});

				google.maps.event.addListener(map, 'zoom_changed', function () {
					zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function (event) {
						if (this.getZoom() > 14 && this.initialZoom == true) { // Change max/min zoom here
							this.setZoom(14);
							this.initialZoom = false;
						}
					google.maps.event.removeListener(zoomChangeBoundsListener);
				});
			});

			for (var i = 0; i < markerData.length; i += 1) {
				var marker = new google.maps.Marker({
				position: {
					lat: markerData[i].position.lat,
					lng: markerData[i].position.lng
				},
				title: markerData[i].title,
				icon: markerData[i].icon,
				map: map
			});

			bounds.extend(marker.position);
			google.maps.event.addListener(marker, 'click', (function (marker, i) {
				return function () {
					window.open(markerData[i].link);
					// window.location.href = markerData[i].link
				}
			})(marker, i));
			markers.push(marker);
		}

		map.initialZoom = true;
		map.fitBounds(bounds);
		}

		window.onload = (function () {
			initMap();
		});
		</script>
	{% endGetCookieConsent %}
</section>